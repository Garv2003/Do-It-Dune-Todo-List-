<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TODO LIST</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body class="flex items-center justify-center h-screen bg-gray-100">
    <div class="w-full max-w-md" x-data="{
        list: [],
        search: '',
        editTask: '',
        open: false,
        editTaskId: null,
        editOpen: false,
        addTask() {
            if (this.search.trim() === '') return;
            this.list.push({
                id: this.list.length + 1,
                title: this.search
            });
            this.search = '';
            this.open=false;
        },
        deleteTask(id) {
            this.list = this.list.filter(item => item.id !== id);
        },
        editTaskFn() {
            console.log(this.editTaskId);
            console.log(this.editTask)
            if (this.editTask.trim() === '') return;
            this.list = this.list.map(item => {
                if (item.id === this.editTaskId) {
                    item.title = this.editTask;
                }
                return item;
            });
            this.editOpen = false;  
        },
        clearList(){
            alert('Are you sure you want to clear all task?');
            this.list = [];
        },
        showEditTask(id){
            this.editOpen = true;
            this.editTask = this.list.find(item => item.id === id).title;
            this.editTaskId = id;
        }

        }" x-init="$watch('list', value => {
            localStorage.setItem('list', JSON.stringify(value));
        }),
        (() => {
            const list = localStorage.getItem('list');
            if (list) {
                $data.list = JSON.parse(list);
            }
        })()
        ">
        <div class="bg-white rounded-lg shadow-lg p-4">
            <div class="flex justify-between items-center mb-6">
                <p class="text-xl font-bold">TODO LIST</p>
                <button @click="open = !open" class="text-sm text-gray-500">Add Task</button>
            </div>
            <div>
                <div x-show="open" @click.away="open = false">
                    <form class="mb-4 flex flex-col gap-2" @submit.prevent="addTask()">
                        <input type="text" class="w-full border rounded p-2" placeholder="Add your task here..."
                            x-model="search">
                        <button type="submit"
                            class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Add
                            Task</button>
                    </form>
                </div>

                <div x-show="editOpen" @click.away="editOpen = false">
                    <form class="mb-4 flex flex-col gap-2" @submit.prevent="editTaskFn()">
                        <input type="text" class="w-full border rounded p-2" placeholder="Add your task here..."
                            x-model="editTask">
                        <button type="submit"
                            class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Edit
                            Task</button>
                    </form>
                </div>
            </div>
            <div class="flex justify-between items-center mb-4">
                <p class="text-lg font-bold">Tasks</p>
                <button class="text-sm text-gray-500" @click="clearList()">Clear All</button>
            </div>
            <div class="bg-gray-100 p-2 rounded-lg">
                <div x-show="list.length === 0">
                    <p class="text-lg text-center text-gray-500">No Task Found</p>
                </div>
                <template x-for="item in list" :key="item.id">
                    <div class="flex items-center justify-between bg-white shadow-lg rounded-lg p-2 mb-2">
                        <p class="text-lg" x-text="item.title"></p>
                        <div>
                            <button class="text-sm text-gray-500" @click="showEditTask(item.id)">Edit</button>
                            <button class="text-sm text-red-500" @click="deleteTask(item.id)">Delete</button>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>


</body>

</html>